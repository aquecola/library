#doc by aquecola since 05.12.2021 (anykey trash)

Добавление всех юзеров в одну группу (powershell):

Get-aduser -filter *|add-adprincipalgroupmembership -memberof ""

 #---#

Добавления пользователя в группу запрета (powershell):

Get-adgroup -Filter {name -like "*запрет*"}| Add-ADGroupMember -members user_name

#---#

UDP, TCP устанавливает соединение между хостами 

#---#

Что-то с днс - хинты:

Подключаешься куда-то не туда значит, что не правильно со стороны. DNS
а что бы это диагностировать надо 
1. Пингануть хост на удаленной машине (которая через vpn) она тебе покажет что она видит
2. Пингануть хост в локальной сети
понять все не так и пойти в dns-сервер и удалить неверную запись 
3. На удаленном подключении сделать ipconfig /flushdns

 #---#

Узнать актуальный процесс на лине и убить его:

ps ax|grep cat
kill -9 [ID]

 #---#

Хинты с "крипто" ключами:

rundll32.exe shell32.dll,Control_RunDLL "C:\Program Files\Crypto Pro\CSP\cpconfig.cpl"

subst w: (виртуальный диск)

 #---#

Что делать если у нас диск полу-мёртвый:

1. Клонировать 1к1 
2. Положить на полочку сбойный 
3. Восстанавливать filesystem на клоне 
4. И только потом пытаться слить данные

 #---#

Ключи CSP: (йохохо)

4.0: 4040W-20000-0168K-VQCQR-8XH45 — клиентская, постоянная
4.0: 40400-00000-11111-101EB-G2EM0 — клиентская, постоянная
4.0: 40400-00000-11111-00NHL-372FM — клиентская, постоянная
4.0: 40400-00000-UKAC8-00PRU-B8HE6 — серверная, постоянная
4.0: 40400-00000-UKAC2-00QP8-MT29G — серверная + Winlogon, постоянная
4.0: 40400-00005-27345-00AYR-235HH — серверная, постоянная
4.0: 4040Y-0000Q-UKAC0-0FV0Y-244K9 — серверная, постоянная

 #---#

Как переделать номер телефона клиента: (VoIP)

1) убрать номер 304 с VOIP-Eltex-TAU-8.IP 192.168.0.31 (если нужно)
2) зайти на телефон, и поправить его настройки (сменить номер) (если есть конфиг, поменять конфиг)

 #---#

Увеличение времени компьютера в блокировку: (через regedit)

Компьютер\HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\
Policies\System

InactivityTimeoutSecs DWORD (32 бита) - указываем время в секундах

 #---#

Хинт по поводу публичного айпишника:

https://www.youtube.com/watch?v=c8qs8WtLfaU,
(vpnki.ru, openWRT)

 #---#

Конвертация кодов RFID для СКУДА и прочих:

https://guardsaas.com/ru/content/keycode

 #---#

Что делать, если сломались сертификаты на лине:

sudo update-ca-certificates
sudo apt install --reinstall ca-certificates

 #---#

Что делать, если не могу установить snap-пакет: (snap сломался)

sudo systemctl restart snapd

 #---#

Предустановки .bash:

Хранится в корневой папке пользователя .bashrc
(пока пишу только alias'ы)

 #---#

NetworkManager: (вдруг забуду)

nmcli con mod eth0 ipv4.addresses 192.168.2.20/24
nmcli con mod eth0 ipv4.gateway 192.168.2.1
nmcli con mod etho ipv4.dns 8.8.8.8
nmcli con mod eth0 ipv4.method manual

nmcli con add type vlan con-name "eth0.1" ifname VLAN5 id 5 dev "eth0" ip4 15.12.10.11/24 gw4 15.12.10.254

 #---#

Что делать, если интерфейс служб недоступен:

sc config openvpnservice start-delayed-auto

 #---#

Как посмотреть действующего пользователя за компом в домене:

quser /server:cs-55

 #---#

Проверка диска:

1) sfc /scannow - чо-то восстанавливает
2) dism /online /cleanup-image /restorehealth
и после отработки 2 идём обратно на шаг 1, и повторяем все это до тех пор пока не будет везде ок 
chkdsk
wmic diskdrive get status

fdisk -l #вывести список всех накопителей#
sudo smartctl -i -a /dev/sda

 #---#

Как сделать скрипт исполняемым:

sudo chmod ugo+x /путь_к_скрипту/имя_скрипта.sh
или
chmod +x hello.sh
картинка со всеми командами chmod у меня на рабочем столе

 #---#

Как заменить кнопки в Linux:

/usr/share/X11/xkb/keycodes

 #---#

Как поменять пароль пользователя cmd win:

net user - вывести всех возможных пользователей
net user #имя пользователя# #pass#
sethc
(полезно, если не знаешь паролей от учётки компов)

 #---#

Как изменить текст в файле (пример):

echo 1 > /proc/sys/net/ipv4/ip_forward

 #---#

Вывести процессы удалённого компа cmd и убить процесс:

tasklist /s Test-PC
tasklist /fi "imagename eq win*"
taskkill /PID 27736 /F
taskkill /IM explorer.exe /F
https://webistore.ru/administrirovaniye-windows/kak-posmotret-spisok-processov-v-windows-na-udalennom-kompyutere/
taskkill /s cs-79 /PID 15188

 #---#

Powershell Scripting:

Get-ExecutionPolicy -list
Set-ExecutionPolicy -ExecutionPolicy Unrestricted -Scope CurrentUser
Get-Help -detailed
Restart-Computer -ComputerName CS-83 -Force
Start-Sleep -Seconds 60; Restart-Computer -ComputerName w10-cl03 -Force
New-Item -Name "testfile.txt" -ItemType "file"

 #---#

$wshell = New-Object -ComObject Wscript.Shell
$wshell.Popup("Данный компьютер будет перезагружен",10,"Сохраните свои данные",0x0)

$wshell.Popup("Перезагрузка будет через 30 секунд",2,"Не забудьте сохранить данные",0x0)

$xCmdString = {sleep 30}

Invoke-Command $xCmdString

Restart-Computer -ComputerName w10-cl01

Get-AddUser -Identity -Properties -filter *
Stop-Process -processname MicrosoftEdge

 #---#

top; ps aux - выведет все процессы
wget
apt-cache search
https://www.vpngate.net/en/

 #---#

Как активировать лицензию через powershell, если есть ключ:

slmgr CS-%% /xpr -  
slmgr CS-%% /ipk -

 #---#

Invoke-Command -ComputerName Server01, Server02 -ScriptBlock {Get-UICulture}
$RProc = Get-Process -Name notepad -ComputerName dc01
Stop-Process -InputObject $RProc

netstat -a - проверить открытые порты
/etc/modprobe.d/50-blacklist.conf 
sudo apt install hostapd - точка доступа wifi тулза
sudo systemctl unmask hostapd

 #---#

Как создать скрипт-службу: (systemctl.service)

sudo vi /lib/systemd/system/runscript.service

записать:
"""
[Unit]
Description=My Script Service
After=multi-user.target
[Service]
Type=idle
ExecStart=/usr/bin/local/script.sh
[Install]
WantedBy=multi-user.target
"""

 sudo chmod 644 /lib/systemd/system/runscript.service

 sudo systemctl daemon-reload

 sudo systemctl enable myscript.service

 sudo chmod u+x /usr/local/bin/script
 
 #---#

 batteryscript.service - энергосбережение батареи Huawei

 #---#
 
 Установка .deb пакетов
 
 sudo dpkg -i имя_пакета.deb
 
 whois - узнать данные об ip
 
 #---#
 
 Как просканировать адреса в подсети утилитой:
 
 nmap -sn 192.168.3.1/24
 
 #---#
 
 Как ввести переменную в .bash и вывести её:
 
 
 export var="123"
 echo $var		Результат в терминале: 123
 
 
 #---#
 
Прослушивание портов:

sudo ss -tulpn

 #---#


 #---#

 #doc after retire since 12.08.2022

 #---#

 #linux

usefull tools and commands:

pstree - show all demons
sudo service restart
sudo systemctl restart
free -m - check free ram
htop - nice tool for monitoring sys, it's like 'windows' task manager

how to generate ssh key: 

ssh-keygen -t ed25519 -C "your_email@example.com"
eval "$(ssh-agent -s)" - show existing ssh keys
ssh-add ~/.ssh/id_ed25519 - add ssh private key to the ssh-agent

 #linux_and_apps_problems

Failed to start LSB: VirtualBox Linux kernel module
solution:
disable secure boot in bios

 #git

Конфигурация находится в директории "Home" на Linux, называется .gitconfig
git init - добавить репозиторий
git status - проверить состояние репозитория
git add -A - добавить трекер на всю директорию

git commit -m 'Add some code'
git commit --amend - поменять текст последнего коммита

git remote add origin "ссылка на репозиторий" - подключение к удалённому репозиторию

git push origin master - отправка локальных изменений на сервер
git fetch - вытаскивание данных с сервера на локальный клиент
git pull - как я понял, делает тоже самое, что и fetch

git branch - создание новой ветки/просмотр веток
git branch -d - удаление ветки
git checkout - переключение на другую ветку
git merge 'название ветки' - объединение действующей с другой веткой

git config pull.rebase false  # merge (the default strategy)
git config pull.rebase true   # rebase
git config pull.ff only       # fast-forward only 

 #---#

 #SDLC

Этапы:

* Анализ требований ("Какие проблемы требуют решений?")
* Планирование ("Что мы хотим сделать?")
* Проектирование и дизайн ("Как мы добьёмся наших целей?")
* Разработка ПО (Непосредственное регулирование процессом создания продукта)
* Тестирование (Обеспечение качественной работы продукта)
* Развёртывание (Регулирование использование релизного продукта)
* Обслуживание (Мониторинг и допил продукта, выпуск обновлений)

Цели:

* Сокращение времени вывода продукта на рынок
* Обеспечение более качественной производительности
* Экономие бюджета и повышение пользы продукт


 #python

a = int(input()) - приглашение на ввод переменной
module pyinstaller
pyinstaller -F test.py - перекомпелировать программу в .exe


 #bash

test command:

$? - the last resault of last command or code
[foo = bar]
echo $? | 0 - true, 1 - false
[] equal test command

(( )) - is used to do arithmetic calculations
example

for (( i=0; i>50; i++ )); do

if statement: 

if [<some test>] #if true
then
  <some commands>
fi

 #docker 

installation:

sudo snap install docker
sudo groupadd docker - create the docker group
sudo usermod -aG docker $USER - add your user to the docker group
newgrp docker

commom commands:

docker pull - download image
docker images - cheking existing images 
docker run - start container
docker ps - show all working containers rn
docker ps -a - show all containers when started in a past
docker run -it busybox sh - starting shell of current container 
docker run -d -P --name static-site prakhar1989/static-site - starting web site where -d - detached mode, -P - makes open ports public
docker run -p 8888:80 'name' - run image on port 8888:80


 #jenkins

installation:

wget -q -O - https://pkg.jenkins.io/debian-stable/jenkins.io.key | sudo apt-key add -
sudo sh -c 'echo deb http://pkg.jenkins.io/debian-stable binary/ > /etc/apt/sources.list.d/jenkins.list'
sudo apt update
sudo apt install jenkins
sudo systemctl start jenkins
sudo systemctl status jenkins
sudo ufw allow 8080 - to ope the port
sudo ufw allow OpenSSH
sudo ufw enable - to enable firewall if it is innactive
sudo ufw status

how to change HTTP port:

vim /etc/default/jenkins (for Debian/Ubuntu)
vim /etc/sysconfig/jenkins (for CentOS)

 #nginx

sudo nginx -t - check configuration files

 #vagrant

vagrant init *author/box - add vagrant configuration and create new evironment, discover vagrant boxes here - https://app.vagrantup.com/boxes/search
vagrant up - start virtual machine
vagrant halt - stop virtual machine
vagrant ssh - connects to machine via ssh
vagrant ssh-config - outputs OpenSSH valid configuration to connect to machine

config example for vagrant virtual machine:

Vagrant.configure(2) do |config|
config.vm.box = "bento/ubuntu-18.04"
config.vm.box_check_update = false
config.vm.provider "virtualbox" do |vb|
vb.name = "ubuntu-1804-test"
vb.memory = 2048
vb.cpus = 1
  end
  
config.vm.hostname = "ubuntu-1804-test"
config.vm.network "public_network"
config.ssh.username = "vagrant"
config.ssh.password = "vagrant"

end
!!!
